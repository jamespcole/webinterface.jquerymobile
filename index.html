<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>XBMC Remote</title>
	<!--<link rel="stylesheet"  href="js/jquerymobile/jquery.mobile-1.1.0-rc.2.min.css" />-->
	<!--<link rel="stylesheet"  href="js/jquerymobile/jquery.mobile-1.0.1.min.css" />-->
	<link rel="stylesheet"  href="js/jquerymobile/jquery.mobile-1.2.0.min.css" />
	<!--<link rel="stylesheet" href="docs/_assets/css/jqm-docs.css" />-->
	<!--<script src="js/jquerymobile/jquery.js"></script>-->
	<script src="js/jquerymobile/jquery-1.8.2.min.js"></script>
	<!--<script src="js/jquerymobile/jquery.mobile-1.1.0-rc.2.min.js"></script>-->
	<!--<script src="js/jquerymobile/jquery.mobile-1.0.1.min.js"></script>-->
	<!--<script src="js/jquerymobile/jquery.mobile-1.0.1.js"></script>-->
	<script src="js/jquerymobile/jquery.mobile-1.2.0.min.js"></script>
	<!--<script src="js/jquery.mkf.js"></script>
	<script src="js/lang/lang.en.js"></script>-->
	<script src="js/lib.xbmc.js"></script>
	
	<style type="text/css">
		.remote-buttons-container {
			width:100% !important;
			max-width:350px !important;
		}

		.remote-button {
			width:33% !important;
		}

		@media all and (min-width: 480px) {
		  .album_info {
		  	display:inline-block;
		    width: 30%;
		    float: right;
		    margin-right: 20px;
		  }
		  .album_info img {
		  	width:100%;
		  	margin-top:15px;
		  }
		  .album_songs {
		    width: 65%;
		    float: left;
		    display:inline-block;
		  }
		}

		@media all and (max-width: 479px) {
		  .album_info {
		    width: 100%;
		  }
		  .album_info img {
		  	width:100%;
		  }
		  .album_songs {
		    width: 100%;
		  }

		  #episode_info img {
		  	width:100%;
		  	margin-right:10px;
		  }
		}

		.round-button {
			width:70px;
			height: 70px;
			border-radius:100%;
			background-color:grey;
			text-align:center;
			background-color: #DDD;
			background-image: -webkit-gradient(linear, left top, left bottom, from(#EEE), to(#CCC));
			background-image: -webkit-linear-gradient(top, #EEE, #CCC);
			background-image: -moz-linear-gradient(top, #EEE, #CCC);
			background-image: -ms-linear-gradient(top, #EEE, #CCC);
			background-image: -o-linear-gradient(top, #EEE, #CCC);
			background-image: linear-gradient(top, #EEE, #CCC);
			border: 1px solid #777;
			display:inline-block;
			cursor:pointer;
			cursor:hand;
		}
		.round-button:active {
			position:relative;
			top:3px;
		}

		.play-button {
			width: 10px;
			height: 0; 
			border-top: 20px solid transparent;
			border-bottom: 20px solid transparent;			
			border-left: 30px solid white;
			/*margin-top:15px;*/
			margin-left:25px;
			margin-right:0px;
			position:relative;
			top:18px;
			margin-top:-5px;
		}

		.pause-button {
			width: 10px; 
			height: 40px; 
			border-left: 10px solid white;		
			border-right: 10px solid white;
			margin-top:15px;
			margin-left:20px;
			margin-right:0px;
		}

		.ff-button {
			padding-left:20px;
			/*padding-top:5px;*/
			position:relative;
			top:20px;
		}

		.ff-button div {
			width: 10px; 
			height: 0; 
			border-top: 15px solid transparent;
			border-bottom: 15px solid transparent;			
			border-left: 20px solid white;
			/*margin-top:15px;*/
			margin-right:0px;
			display:inline-block;
			margin-left:-10px;
		}

		.rw-button {
			padding-left:0px;
			/*padding-top:5px;*/
			position:relative;
			top:20px;
		}

		.rw-button div {
			width: 10px; 
			height: 0; 
			border-top: 15px solid transparent;
			border-bottom: 15px solid transparent;			
			border-right: 20px solid white;
			/*margin-top:15px;*/
			margin-right:0px;
			display:inline-block;
			margin-left:-10px;
		}

		.home-button {
			
			/*padding-top:5px;*/
			position:relative;
			top:-5px;
		}

		.home-button div:first-child {
			width: 0px;
			height: 0; 
			/*border-top: 20px solid transparent;*/
			border-bottom: 15px solid white;			
			border-left: 30px solid transparent;			
			border-right: 30px solid transparent;
			left:-40px;
			position:relative;
			top:-30px;
			margin:45px;
		}

		.home-button div:last-child {
			width: 10px;
			height: 0; 
			border-top: 15px solid white;
			border-bottom: 15px solid white;			
			border-left: 15px solid white;			
			border-right: 15px solid white;
			left:15px;
			
			position:relative;
			top:-75px;
		}

		.up-button {
			position:relative;
			top:-5px;
		}
		.up-button div:first-child {
			width: 0px;
			height: 0; 
			/*border-top: 25px solid transparent;*/
			border-bottom: 35px solid white;			
			border-left: 25px solid transparent;			
			border-right: 25px solid transparent;
			left:10px;
			position:relative;
			top:-44px;
			margin-top: 62px;
		}

		.back-button {
			position:relative;
			top:-5px;
		}
		.back-button div:first-child {
			width: 0px;
			height: 0; 
			border-top: 15px solid transparent;
			border-bottom: 15px solid transparent;			
			border-right: 15px solid white;
			position:relative;
			top:-12px;
			margin-top: 29px;
			left:10px;
		}

		.back-button div:last-child {
			width: 20px;
			height: 20px; 
			border-top: 5px solid white;		
			border-right: 5px solid white;
			position:relative;
			top:-30px;
			margin-top: 0px;
			left:20px;
		}

		.left-button {
			position:relative;
			top:-5px;
		}
		.left-button div:first-child {
			width: 0px;
			height: 0; 
			border-top: 25px solid transparent;
			border-bottom: 25px solid transparent;			
			border-right: 35px solid white;
			position:relative;
			top:-12px;
			margin-top: 29px;
			left:10px;
		}

		.right-button {
			position:relative;
			top:-5px;
		}
		.right-button div:first-child {
			width: 0px;
			height: 0; 
			border-top: 25px solid transparent;
			border-bottom: 25px solid transparent;			
			border-left: 35px solid white;
			position:relative;
			top:-12px;
			margin-top: 29px;
			left:10px;
		}

		.select-button {
			position:relative;
			top:-5px;
		}
		.select-button div:first-child {
			width: 10px;
			height: 10px; 
			border:solid white 15px;
			position:relative;
			top:-18px;
			margin-top: 38px;
			left:15px;
		}

		.round-button-holder {
			width:100%;
			text-align:center;
			margin-bottom:5px;
		}

	</style>

	<script type="text/javascript">
	var useCaching = true;
	var volume = 0;
	
		$('.music-link').live("tap", function(e)
		{
			var file = $(e.target).attr('data-file');
			xbmc.playAudioFile({file:file});
		});
		$('.music-link').live("taphold", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#file_options?file=' + file + '&category=music', {transition: 'pop', role: 'dialog'}); 
			 
		});

		//this is for the play button on the file option dialog
		$('.play-music').live("tap", function(e)
		{
			var file = $(this).attr('data-file');
			console.log("Playing " + file);
			xbmc.playAudioFile({file:file});
			history.back();
			 
		});

		$('.music-folder').live("taphold", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#folder_options?file=' + file + '&category=music', {transition: 'pop', role: 'dialog'}); 
			 
		});

		$('.music-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#filelist?file=' + file + '&category=music'); 
			 
		});

		$('.play-music-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(this).attr('data-file');
			console.log("playing " + file);
			xbmc.playAudioFolder({folder: file, onError : showError});
			//console.log(file);
			history.back();
			 
		});

		$('.queue-music-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(this).attr('data-file');
			console.log(file);
			xbmc.addAudioFolderToPlaylist({folder: file, onError : showError});
			//console.log(file);
			history.back();
			 
		});
	
		$('.video-link').live("taphold", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#file_options?file=' + file + '&category=video', {transition: 'pop', role: 'dialog'}); 
			 
		});

		//this is for the play button on the file option dialog
		$('.play-video').live("tap", function(e)
		{
			var file = $(this).attr('data-file');
			console.log("Playing " + file);
			xbmc.playVideoFile({file:file});
			history.back();
			 
		});

		$('.video-folder').live("taphold", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#folder_options?file=' + file + '&category=video', {transition: 'pop', role: 'dialog'}); 
			 
		});

		$('.video-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(e.target).attr('data-file');
			//console.log(file);
			//forward slashes mess up the query string so replace them 
			//and change back later(even though they are valid jqmobile doesn't like them)
			file = file.replace(/\//g, "\\");
			$.mobile.changePage('#filelist?file=' + file + '&category=video'); 
			 
		});

		$('.play-video-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(this).attr('data-file');
			//console.log($(e.target).closest('a').parent().html());
			xbmc.playVideoFolder({folder: file, onError : showError});
			//console.log(file);
			history.back();
			 
		});

		$('.queue-video-folder').live("tap", function(e)
		{
			e.preventDefault();
			var file = $(this).attr('data-file');
			console.log(file);
			xbmc.addVideoFolderToPlaylist({folder: file, onError : showError});
			//console.log(file);
			history.back();
			 
		});

		
		$('.video-link').live("tap", function(e)
		{
			var file = $(this).attr('data-file');
			console.log("Playing " + file);
			xbmc.playVideoFile({file:file});
		});

		$('.queue-video').live("tap", function(e)
		{
			var file = $(this).attr('data-file');
			console.log("Queueing " + file);
			xbmc.addVideoFileToPlaylist({file: file, onError : showError});
		});

		$('.video-unqueue').live("tap", function(e)
		{
			var xbmc_index = $(this).attr('xbmc-index');
			console.log("Removing " + xbmc_index);
			xbmc.removeVideoPlaylistItem({item : xbmc_index});
			history.back();
		});

		$('.music-unqueue').live("tap", function(e)
		{
			var xbmc_index = $(this).attr('xbmc-index');
			console.log("Removing " + xbmc_index);
			xbmc.removeAudioPlaylistItem({item : xbmc_index, onError : showError});
			history.back();
		});


		$('.queue-music').live("tap", function(e)
		{
			var file = $(this).attr('data-file');
			console.log("Queueing Music " + file);
			xbmc.addAudioFileToPlaylist({file: file, onError : showError});
		});

		$('.playlist-item').live("tap", function(e)
		{
			e.preventDefault();
			var index = $(e.target).attr('xbmc-index');
			var category = $(e.target).attr('xbmc-category');
			
			$.mobile.changePage('#playlist_options?index=' + index + '&category=' + category, {transition: 'pop', role: 'dialog'}); 
		});

		$('.mute-button').live("tap", function(e) {
			xbmc.setMute();
		});

		$('.play-playlist-item').live("tap", function(event) {	
				var category = 	$(this).attr('xbmc-category');
				var index = $(this).attr('xbmc-index');
				//console.log(category + ' ' + index);
				if(category == "music" || category == "audio")	
					xbmc.playlistPlay({item: index});
				else if(category == "video")	
					xbmc.playlistPlay({item: index, playlistid : 1, onError: showError})
				history.back();
			});
		
		$(document).ready(function() {

			xbmc.periodicUpdater.addVolumeChangedListener(volumeChanged);
			xbmc.periodicUpdater.addPlayerStatusChangedListener(statusChanged);
			xbmc.periodicUpdater.addCurrentlyPlayingChangedListener(playingChanged);
			xbmc.periodicUpdater.addProgressChangedListener(progressChanged);
			xbmc.periodicUpdater.start();
			 $(".swipable").live('swiperight', function() {
				history.back();
			  });
			$(".swipable").live('swipeleft', function() {
				history.forward();
			  });
			$(".play-toggle").live("click", function() {
				xbmc.control({'type' : 'play', onSuccess : togglePlayPauseButton})
			});

			$('.prev-button').live("click", function() {
				if(currentPlayType == "audio")
					xbmc.control({type : 'prev'});
				else
					xbmc.input({type : 'Left'});
			});

			$('.next-button').live("click", function() {
				if(currentPlayType == "audio")
					xbmc.control({type : 'next'});
				else
					xbmc.input({type : 'Right', onError : showError});
				console.log(currentPlayType);
			});
			//document.oncontextmenu = function() {return false;};
			$.mobile.changePage(document.location.hash);
			$.mobile.loading( 'hide' );
			//alert(document.location.hash);
			//console.log(document.location.hash);
		});

		function togglePlayPauseButton()
		{
			$(".play-toggle").each(function(index, value) { 
			   if($(this).hasClass("play-button"))
				{
					$(this).removeClass("play-button");
					$(this).addClass("pause-button");
				}
				else
				{
					$(this).removeClass("pause-button");
					$(this).addClass("play-button");
				}
			});
		}
		var currentPlayType = '';
		function playingChanged(file)
		{
			console.log(file);
			$('.now_playing_name').html(file.label);
			if(file.thumbnail != '')
			{
				$('.now_playing_thumbnail').attr("src", xbmc.getThumbUrl(file.thumbnail));
				$('.now_playing_thumbnail').show()
			}
			else
				$('.now_playing_thumbnail').hide();
			//show selected class for currently playing playlist item
			$('.playlist-item').closest('li').attr("data-theme", "c").removeClass('ui-btn-up-a').addClass('ui-btn-up-c');
			$('.playlist-item[xbmc-label="' + file.label + '"]').closest('li').attr("data-theme", "a").removeClass('ui-btn-up-c').addClass('ui-btn-up-a');
			if(file.label == '')
			{
				$('.now-playing').slideUp();
			
				$('.play-toggle').addClass("play-button");
				$('.play-toggle').removeClass("pause-button");
			}
			else
			{
				$('.now-playing').slideDown();

				$('.play-toggle').removeClass("play-button");
				$('.play-toggle').addClass("pause-button");
			}
			currentPlayType = file.xbmcMediaType;
			//alert($('.playlist-item[xbmc-label="' + file.label + '"]').closest('li').html());
			//$("#playlist_list").listview("refresh");
		}

		function progressChanged(progress)
		{
			//console.log(progress);
			$('.now_playing_time').html(progress.time + " / " + progress.total);
		}

		function statusChanged(status)
		{			
			console.log(status);
			if(status == 'stopped')
			{
				$('.now-playing').slideUp();
				currentPlayType = '';
			}
			if(status == 'playing')
			{
				$('.play-toggle').removeClass("play-button");
				$('.play-toggle').addClass("pause-button");
				$('.now-playing').slideDown();
			}
			if(status == 'paused')
			{
				$('.play-toggle').addClass("play-button");
				$('.play-toggle').removeClass("pause-button");
			}
		}

		$("#remote").live('pageinit', function() {
			
			$( "#volume" ).val(volume);
			$( "#volume" ).slider("refresh");
            $( "#volume" ).bind( "slidestop", function(event, ui) {                		
				xbmc.setVolume({volume:$(event.target).val()});
			});

			$('.xbmc-input').bind("click", function(event) {				
				xbmc.input({type: $(this).attr('xbmc-input')})
			});

			$('.xbmc-player').bind("click", function(event) {				
				xbmc.control({type: $(this).attr('xbmc-control')})
			});

			
	     });

		$("#now_playing").live('pageinit', function() {
			
			$( "#volume_np" ).val(volume);
			$( "#volume_np" ).slider("refresh");
                	$( "#volume_np" ).bind( "slidestop", function(event, ui) {
				xbmc.setVolume({volume:$(event.target).val()});
			});

            $('.xbmc-input').bind("click", function(event) {				
				xbmc.input({type: $(this).attr('xbmc-input')})
			});

			$('.xbmc-player').bind("click", function(event) {				
				xbmc.control({type: $(this).attr('xbmc-control')})
			});
	     });

		/*$("#playlist").live('pageinit', function() {
			console.log("playlist");
			$('.playlist-item').bind("tap", function(event) {	
				var category = 	$(this).attr('xbmc-category');
				var index = $(this).attr('xbmc-index');
				//console.log(category + ' ' + index);
				if(category == "music")	
					xbmc.playAudio({item: index});
				else if(category == "video")	
					xbmc.playVideo({item: index, onError: showError})
			});

			
	            });*/

		function volumeChanged(vol)
		{
			volume = vol;
			
			$( ".volume" ).val(volume);
			try
			{
				$( ".volume" ).slider("refresh");
			}
			catch(ex)
			{

			}
		}

	String.prototype.hashCode = function(){
	    var hash = 0;
	    if (this.length == 0) return hash;
	    for (i = 0; i < this.length; i++) {
		char = this.charCodeAt(i);
		hash = ((hash<<5)-hash)+char;
		hash = hash & hash; // Convert to 32bit integer
	    }
	    return hash;
	}

	jQuery.extend({
		parseQuerystring: function(qs){
		var nvpair = {};
		
		if(qs.indexOf('?') > -1)
		{
			var bits = qs.split("?");
			if(bits.length > 1)
				qs = bits[1];
			else
				qs = bits[0];
			
		}
		var pairs = qs.split('&');
		if(qs.indexOf('&') > -1)
		{
			$.each(pairs, function(i, v){
				var pair = v.split('=');
				nvpair[pair[0]] = pair[1];
			});
		}
		else
		{
			var pair = qs.split('=');
			if(pair.length > 1)
				nvpair[pair[0]] = pair[1];
		}
		return nvpair;
		}
	});
		$( document ).bind( "pageshow", function( event, data ){
			//$.mobile.showPageLoadingMsg();
			$.mobile.loading("hide");
		});
		var urlObj = null;
		var options = null;

		// Listen for any attempts to call changePage().
		//$(document).bind( "pagebeforechange", function( e, data ) {
			$(document).bind( "pagebeforechange", function( e, data ) {
				loadThePage( e, data );
			});
			/*$(document).bind( "mobileinit", function( e, data ) {
				//loadThePage( e, data );
				alert("here");
			});*/

		function loadThePage( e, data )
		{

			//$.mobile.showPageLoadingMsg();
			$.mobile.loading( 'show' );
			if ( typeof data.toPage === "string" ) {
				console.log(data);

				var u = $.mobile.path.parseUrl( data.toPage );
					pageSelector = u.hash.replace( /\?.*$/, "" );
					//console.log(pageSelector);
					//pageSelector = data.toPage.substring(data.toPage.indexOf("#"), data.toPage.indexOf("?"));
					//alert(data.toPage);
					if(pageSelector == "#sourcelist")
					{
						showSourceList( u, data.options );
						e.preventDefault();
					}
					else if(pageSelector == "#filelist")
					{						
						showFileList( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#playlist")
					{						
						showPlaylist( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#file_options")
					{						
						showFileOptions( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#folder_options")
					{						
						showFolderOptions( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#playlist_options")
					{						
						showPlaylistOptions( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#tvshows")
					{						
						showTVShows( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#tvseasons")
					{			
						showTVSeasons( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#tvseason")
					{			
						showTVSeason( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#music_albums" || pageSelector == "#music_artist_albums")
					{			
						showAlbums( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#music_album")
					{			
						showAlbum( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#music_artists")
					{			
						showArtists( u, data.options);						
						e.preventDefault();						
					}
					else if(pageSelector == "#episode_info")
					{
						showEpisodeInfo( u, data.options);						
						e.preventDefault();
					}
					else if(pageSelector == "#song_options")
					{
						showSongOptions( u, data.options);						
						e.preventDefault();
					}
					else if(pageSelector == "#global_options")
					{
						renderGlobalOptions( u, data.options);						
						e.preventDefault();
					}
					else if(pageSelector == "#channels")
					{
						showChannels( u, data.options);						
						e.preventDefault();
					}
					else if(pageSelector == "#channel_groups")
					{
						showChannelGroups( u, data.options);						
						e.preventDefault();
					}


					/*alert(pageSelector);
					re = /^#sourcelist/;
				if ( u.hash.search(re) !== -1 ) {
					showSourceList( u, data.options );
					e.preventDefault();
				}*/
			}
			else
			{				
				//$.mobile.changePage('#lobby?user=1234')
			}
		}
		//});

		function showSourceList( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);
			
			//var categoryName = urlObj.hash.replace( /.*category=/, "" );
			var categoryName = qs['category'];
			if ( categoryName ) 
			{
				xbmc.getSources({onSuccess: renderSourceList, media:categoryName});
			}
			
		}

		function renderSourceList(result)
		{
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var category = qs['category'];

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			var markup = '';			
			if(result.limits.total == 0 || result.sources.length == 0)
			{
				markup = "There are no " + category + " sources defined in XBMC.  Please add them via XBMC first."
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.sources.length; i++)
				{
					//forward slashes mess up the query string so replace them 
					//and change back later(even though they are valid jqmobile doesn't like them)
					file = result.sources[i].file.replace(/\//g, "\\");
					markup += '<li><a href="/#filelist?file=' + escape(file) + '&category=' + category + '">' + result.sources[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}

		function showFileList( urlInfoObj, nav_options )
		{
			$.mobile.showPageLoadingMsg();
			
			urlObj = urlInfoObj;
			options = nav_options;
				
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);
			var category = qs['category'];
			//var file = unescape(urlObj.hash.replace( /.*file=/, "" ).replace(/\\/g, "/"));
			
			var file = getFile(qs['file']);
			//var file = getFile(urlObj.hash);
			var new_div_id = urlObj.hash.hashCode();
			if(useCaching && $('#' + new_div_id).length > 0)
			{				
				var $page = $( '#' + new_div_id );
				options.dataUrl = urlObj.href;
				$.mobile.changePage( $page, options );
			}
			else
			{
				xbmc.getDirectory({directory: file, onSuccess: renderFileList, media:category, onError:showError});
			}
			
		}

		function renderFileList(result)
		{			
			$.mobile.showPageLoadingMsg();
			//var parent_file = unescape(urlObj.hash.replace( /.*file=/, "" ).replace(/\\/g, "/"));
			var qs = $.parseQuerystring(urlObj.hash);
			//var parent_file = getFile(urlObj.hash);
			var parent_file = getFile(qs['file']);
			var category = qs['category'];		
			var new_div_id = urlObj.hash.hashCode();
			if($('#' + new_div_id).length == 0)
			{
				var new_div = $('<div id="' + new_div_id + '" data-role="page" data-add-back-btn="true" class="file-list swipable"></div>');
				var heading = "Music";
				if(category == "video")
					heading = "Videos";
				new_div.append(getHeaderBar(heading, category));
				new_div.append('<div data-role="content"></div>');
				$('body').append(new_div);
			}
			//pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			//var $page = $( pageSelector );
			var $page = $( '#' + new_div_id );
			$content = $page.children( ":jqmData(role=content)" );
			
				
			//alert(JSON.stringify(result));
			var markup = "<ul data-role='listview' data-inset='true'>";
			markup += '<li data-role="list-divider">XBMC</li>';
			for(var i = 0; i < result.files.length; i++)
			{
				file = result.files[i].file.replace(/\//g, "\\");
				if(result.files[i].filetype == "directory")
				{
					markup += '<li><a class="' + category + '-folder" href="javascript:void(0)" xbmc-href="/#filelist?file=' + escape(file) + '&category=' + category + '" data-file="' + result.files[i].file + '">' + result.files[i].label + '</a></li>';
				}
				else
				{
					markup += '<li><a class="' + category + '-link" href="javascript:void(0)" data-file="' + result.files[i].file + '">' + result.files[i].label + '</a></li>';
				}
				
			}
			markup += "</ul>";
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			options.dataUrl = urlObj.href;
			
			//$.mobile.hidePageLoadingMsg();
			$.mobile.changePage( $page, options );
		}

		function getHeaderBar(heading, category)
		{
			var markup = '<div data-role="header">';
			//markup += '<a href="index.html" data-icon="delete"></a>';
			markup += '<h1>' + heading + '</h1>';
			markup += '<a href="#playlist?category=' + category + '" data-icon="check" class="ui-btn-right" data-transition="flip">Playlist</a>';
			markup += '</div>';
			return markup;
		}

		function getFile(url)
		{
			//return unescape(url.replace( /.*file=/, "" ).replace(/\\/g, "/"));
			return unescape(url).replace(/\\/g, "/");
		}

		function showError(err)
		{
			alert(err.error.message);
			console.log(err);
		}

		function showPlaylist(urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;
			var qs = $.parseQuerystring(urlObj.hash);
			console.log(currentPlayType);
			if(qs['category'] == undefined)
				qs['category'] = currentPlayType;
			if(qs['category'] == "")
				qs['category'] = "audio";
			if(qs['category'] == "music" || qs['category'] == "audio")
				xbmc.getAudioPlaylist({onSuccess : renderPlaylist});
			else if(qs['category'] == "video")
				xbmc.getVideoPlaylist({onSuccess : renderPlaylist});


		}

		function renderPlaylist(result)
		{
			//console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);	
			if(qs['category'] == undefined)
				qs['category'] = currentPlayType;
			if(qs['category'] == "")
				qs['category'] = "music";					
			var category = qs['category'];
			

			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );
			var markup = '';
			if(result.items)
			{
				markup = "<ul data-role='listview' data-inset='true' id='playlist_list'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.items.length; i++)
				{
					markup += '<li><a href="javascript:void(0)" class="playlist-item" xbmc-category="' + category + '" xbmc-index="' + i + '" xbmc-label="' + result.items[i].label + '">' + result.items[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			else
			{
				markup = "Playlist is empty";
			}
			$content.html(markup);

			if(category == "video")
			{
				$page.find( ":jqmData(role=header) h1" ).html("Video Playlist");
				$page.find( ":jqmData(role=header) a.ui-btn-right").attr("href", "#playlist?category=music");
				$page.find( "#change_playlist_btn_text").html("Music Playlist");
			}
			else if(category == "music")
			{
				$page.find( ":jqmData(role=header) h1" ).html("Audio Playlist");
				//$("#change_playlist_button").html("Video Playlist").attr("href", "#playlist?category=video");
				$page.find( ":jqmData(role=header) a.ui-btn-right").attr("href", "#playlist?category=video");
				$page.find( "#change_playlist_btn_text").html("Video Playlist");
			}
			else
				$page.find( ":jqmData(role=header) h1" ).html("Playlist");
			

			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			//$page.find( ":jqmData(role=header)" ).find( ":jqmData(role=button)" ).button();
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
			$.mobile.loading("hide");
		}

		function showFileOptions( urlInfoObj, nav_options )
		{
			//alert('showFileList');
			urlObj = urlInfoObj;
			options = nav_options;
				
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);
			var category = qs['category'];
			//var file = unescape(urlObj.hash.replace( /.*file=/, "" ).replace(/\\/g, "/"));
			
			var file = getFile(qs['file']);
			//var file = getFile(urlObj.hash);
			
			
			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			markup = '<a data-role="button" class="play-' + category + '" data-file="' + file + '" href="javascript:void(0)">Play</a>';
			markup += '<a data-role="button" class="queue-' + category + '" data-file="' + file + '" href="javascript:void(0)">Queue</a>';
			markup += '<a data-rel="back" data-role="button" href="#">Close</a>';

			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=button)" ).button();
			options.role = "dialog";
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}

		function showFolderOptions( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;
				
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);			
			var category = qs['category'];
			
			var file = getFile(qs['file']);
			
			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			markup = '<a data-role="button" class="play-' + category + '-folder" data-file="' + file + '" href="javascript:void(0)">Play</a>';
			markup += '<a data-role="button" class="queue-' + category + '-folder" data-file="' + file + '" href="javascript:void(0)">Queue</a>';
			markup += '<a data-rel="back" data-role="button" href="#">Close</a>';

			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=button)" ).button();
			options.role = "dialog";
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}
		function showPlaylistOptions( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;
				
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);
			if(qs['category'] == undefined)
				qs['category'] = currentPlayType;
			if(qs['category'] == "" || qs['category'] == "audio")
				qs['category'] = "music";
			var category = qs['category'];
			
			var index = getFile(qs['index']);			
			
			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );
			markup = '<a data-role="button" class="play-playlist-item" xbmc-category="' + category + '" xbmc-index="' + index + '" href="javascript:void(0)">Play</a>';
			markup += '<a data-role="button" class="' + category + '-unqueue" xbmc-index="' + index + '" href="javascript:void(0)">Remove</a>';
			//markup += '<a data-role="button" class="queue-' + category + '" xbmc-index="' + index + '" href="javascript:void(0)">Queue</a>';
			markup += '<a data-rel="back" data-role="button" href="#">Cancel</a>';

			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=button)" ).button();
			options.role = "dialog";
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}

		//TV SHOW STUFF
		function showTVShows( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);
			
			xbmc.getTvShows({onSuccess: renderTVShowList});	
		}

		function renderTVShowList(result)
		{
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var category = qs['category'];

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result.limits.total == 0 || result.tvshows.length == 0)
			{
				markup = "There are no TV Shows in you library.  Please scan your video sources from XBMC to add them.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.tvshows.length; i++)
				{
					//forward slashes mess up the query string so replace them 
					//and change back later(even though they are valid jqmobile doesn't like them)
					//file = result.tvshows[i].file.replace(/\//g, "\\");
					markup += '<li><a href="/#tvseasons?tvshowid=' + result.tvshows[i].tvshowid + '">' + result.tvshows[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			options.dataUrl = urlObj.href;

			
			$.mobile.changePage( $page, options );
			console.log(result);
		}

		function showTVSeasons( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var tvshowid = qs['tvshowid'];
			
			xbmc.getSeasons({onSuccess: renderTVSeasonsList, tvshowid : tvshowid, onError: showError});	
		}

		function renderTVSeasonsList(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var tvshowid = qs['tvshowid'];

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result.limits.total == 0 || result.seasons.length == 0)
			{
				markup = "There are no seasons available for this show.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.seasons.length; i++)
				{
					//forward slashes mess up the query string so replace them 
					//and change back later(even though they are valid jqmobile doesn't like them)
					//file = result.tvshows[i].file.replace(/\//g, "\\");
					markup += '<li><a href="/#tvseason?season=' + result.seasons[i].season + '&tvshowid=' + tvshowid + '">' + result.seasons[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			options.dataUrl = urlObj.href;

			
			$.mobile.changePage( $page, options );
			//console.log(result);
		}

		function showTVSeason( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var tvshowid = qs['tvshowid'];
			var season = qs['season'];
			
			xbmc.getEpisodes({onSuccess: renderTVSeasonList, item : 'tvshowid', itemId : tvshowid, season : season, onError: showError});	
		}

		function renderTVSeasonList(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var tvshowid = qs['tvshowid'];
			var season = qs['season'];

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result.limits.total == 0 || result.episodes.length == 0)
			{
				markup = "There are no episodes available for this season.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.episodes.length; i++)
				{
					//forward slashes mess up the query string so replace them 
					//and change back later(even though they are valid jqmobile doesn't like them)
					//file = result.tvshows[i].file.replace(/\//g, "\\");
					//markup += '<li><a href="javascript:void(0)" onclick="xbmc.playEpisode({episodeid : ' + result.episodes[i].episodeid + '})">' + result.episodes[i].label + '</a></li>';
					markup += '<li><a href="/#episode_info?episodeid=' + result.episodes[i].episodeid + '">' + result.episodes[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			options.dataUrl = urlObj.href;

			
			$.mobile.changePage( $page, options );
			//console.log(result);
		}

		function showEpisodeInfo( urlInfoObj, nav_options )
		{			
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var episodeid = qs['episodeid'];			
			
			xbmc.getEpisodeDetails({onSuccess: renderEpisodeInfo, episodeid : episodeid});	
		}

		function renderEpisodeInfo(result)
		{
			console.log(result);
			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			var qs = $.parseQuerystring(urlObj.hash);
			var episodeid = qs['episodeid'];
			
			var markup = '';
			if(result.thumbnail != '')
				markup += '<img src="' + xbmc.getThumbUrl(result.thumbnail) + '" />';
			markup += "<h1>" + result.label + "</h1>";
			markup += "<h2> Season " + result.season + " Episode " + result.episode + "</h2>";
			markup += "<p>" + result.plot + "</p>";

			markup += '<a href="javascript:void(0)" onclick="xbmc.playerOpen({item : \'episodeid\', itemId : ' + episodeid + ', onError : showError})" data-role="button" data-inline="true">Play Episode</a>';
			markup += '<a href="javascript:void(0)" onclick="xbmc.playlistAdd({item : \'episodeid\', itemId : ' + episodeid + ', playlistid: 1})" data-role="button" data-inline="true">Queue Episode</a>';

			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			$content.find( ":jqmData(role=button)" ).button();
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}

		//declare this global so we don't have to make a second call to get the album info
		//var albums = null;
		var albums_loaded = false;
		function showAlbums( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var artistid = qs['artistid'];			
			var genreid = qs['genreid'];
			//console.log(artistid);
			
			if(artistid == undefined && genreid == undefined)
			{
				if(!albums_loaded)	
					xbmc.getAlbums({onSuccess: renderAlbumList, onError : showError});
				else
				{
					//renderAlbumList(albums);
					$.mobile.loading( 'show' );
					console.log("loading cached version of albums");
					var $page = $( pageSelector );
					$page.page();
					$.mobile.changePage( $page, options );
				}
			}
			else if(artistid != undefined)
				xbmc.getAlbums({onSuccess: renderAlbumList, onError : showError, item : "artistid", itemId : artistid});
		}
		
		function renderAlbumList(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var artistid = qs['artistid'];			
			var genreid = qs['genreid'];

			/*if(artistid == undefined && genreid == undefined)
				albums = result;*/
			if(artistid == undefined && genreid == undefined)
				albums_loaded = true;

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result == null || result.limits.total == 0 || result.albums.length == 0)
			{
				markup = "There are no albums in your library.";				
			}
			else
			{				
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.albums.length; i++)
				{
					var label = result.albums[i].label;
					if(pageSelector == "#music_albums")
						label += " - " + result.albums[i].artist;
					markup += '<li><a href="#music_album?albumid=' + result.albums[i].albumid + '">' + label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();

			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
			//console.log(result);
		}

		function showAlbum( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var albumid = qs['albumid'];
			
			xbmc.getSongs({onSuccess: renderAlbum, item : "albumid", itemId : albumid});	
		}

		function renderAlbum(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			var albumid = qs['albumid'];
			var album_index = qs['album_index'];

			var $page = $( pageSelector );
			$content = $page.children( ":jqmData(role=content)" );
			
			var markup = '<div id="album_info" class="album_info"></div>';			
			if(result.limits.total == 0 || result.songs.length == 0)
			{
				markup = "There are no songs in this album.";
			}
			else
			{
				markup += "<ul data-role='listview' data-inset='true' class='album_songs'>";
				markup += '<li data-role="list-divider">Tracks</li>';
				for(var i = 0; i < result.songs.length; i++)
				{
					//markup += '<li><a href="javascript:void(0)" onclick="xbmc.playSong({songid : ' + result.songs[i].songid + '})">' + ((result.songs[i].track < 6000) ? result.songs[i].track + ". " : '') + result.songs[i].label + '</a></li>';
					markup += '<li><a href="#song_options?song_id=' + result.songs[i].songid + '">' + ((result.songs[i].track < 6000) ? result.songs[i].track + ". " : '') + result.songs[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
			//$content.find( ":jqmData(role=header)" ).html(getLibraryHeaderBar("Artists")).page();
			options.dataUrl = urlObj.href;

			
			$.mobile.changePage( $page, options );
			//console.log(result);
			loadAlbumInfo(albumid, $content, $page);
		}

		function loadAlbumInfo(albumid, content, page)
		{
			xbmc.getAlbumDetails({onSuccess: function(result){
				console.log(result);
				var markup = '';
				if(result.thumbnail != '')
					markup += '<img src="' + xbmc.getThumbUrl(result.thumbnail) + '" />';
				markup += '<h2>' + result.artist + '</h2>';
				markup += '<h3>' + result.label + '</h3>';
				markup += '<a href="javascript:void(0)" onclick="xbmc.playerOpen({item : \'albumid\', itemId : ' + albumid + '})" data-role="button" data-inline="true">Play Album</a>';
				markup += '<a href="javascript:void(0)" onclick="xbmc.playlistAdd({item : \'albumid\', itemId : ' + albumid + '})" data-role="button" data-inline="true">Queue Album</a>';
				$('#album_info').html(markup);
				content.find( ":jqmData(role=button)" ).button();
				page.find( ":jqmData(role=header) h1" ).html(result.label);
			}, onError: showError, albumid : albumid});
		}

		//declare this global so we don't have to make a second call to get the album info
		var artists = null;
		function showArtists( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);			
			var genreid = qs['genreid'];			
			
			if(genreid == undefined)
			{
				if(artists == null)	
					xbmc.getArtists({onSuccess: renderArtistList, genreid : genreid});	
				else
				{
					//renderAlbumList(albums);
					$.mobile.loading( 'show' );
					console.log("loading cached version of artists");
					var $page = $( pageSelector );
					$page.page();
					$.mobile.changePage( $page, options );
				}
			}
			else if(genreid != undefined)
				xbmc.getArtists({onSuccess: renderArtistList, genreid : genreid});	
			
		}
		
		function renderArtistList(result)
		{
			artists = result;
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);						
			//var tvshowid = qs['tvshowid'];
			//var season = qs['season'];

			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result == null || result.limits.total == 0 || result.artists.length == 0)
			{
				markup = "There are no artists in your library.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">XBMC</li>';
				for(var i = 0; i < result.artists.length; i++)
				{
					markup += '<li><a href="#music_artist_albums?artistid=' + result.artists[i].artistid + '&artist_index=' + i + '">' + result.artists[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
		
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
			//console.log(result);
		}

		function showSongOptions( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);
			var songid = qs['song_id'];
			console.log("options for song " + songid);

			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );

			var markup = '';
			markup += '<a data-role="button" href="javascript:void(0)" onclick="xbmc.playerOpen({item : \'songid\', itemId : ' + songid + ', onSuccess: function(result) {history.back()}})">Play Song</a>';
			markup += '<a data-role="button" href="javascript:void(0)" onclick="xbmc.playlistAdd({item : \'songid\', itemId : ' + songid + ', onSuccess: function(result) {history.back()}})">Queue Song</a>';
			markup += '<a data-rel="back" data-role="button" href="#">Cancel</a>';
			
			//console.log($content.html());
			//console.log(markup);
			$content.html(markup);

			$page.page();			
			$content.find( ":jqmData(role=button)" ).button();
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}

		function showChannelGroups( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);			
			
			xbmc.pvrGetChannelGroups({onSuccess: renderChannelGroups});				
		}

		function renderChannelGroups(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);

			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result == null || result.limits.total == 0 || result.channelgroups.length == 0)
			{
				markup = "There channels available.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">Stations</li>';
				for(var i = 0; i < result.channelgroups.length; i++)
				{
					markup += '<li><a href="#channels?channelgroupid=' + result.channelgroups[i].channelgroupid + '">' + result.channelgroups[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
		
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}		

		function showChannels( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);			
			var channelgroupid = qs['channelgroupid'];
			
			xbmc.pvrGetChannels({onSuccess: renderChannels, channelgroupid : channelgroupid});				
		}


		function renderChannels(result)
		{
			console.log(result);
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			var qs = $.parseQuerystring(urlObj.hash);

			var $page = $( pageSelector );
			$content = $page.find( ":jqmData(role=content)" );
			
			var markup = '';			
			if(result == null || result.limits.total == 0 || result.channels.length == 0)
			{
				markup = "There channels available.";
			}
			else
			{
				markup = "<ul data-role='listview' data-inset='true'>";
				markup += '<li data-role="list-divider">Stations</li>';
				for(var i = 0; i < result.channels.length; i++)
				{
					markup += '<li><a href="javascript:void()" onclick="xbmc.playerOpen({item : \'channelid\', itemId : ' + result.channels[i].channelid + '})">' + result.channels[i].label + '</a></li>';
					//markup += '<li><a href="javascript:void()" class="channel-button">' + result.channels[i].label + '</a></li>';
				}
				markup += "</ul>";
			}
			$content.html(markup);
			$page.page();
			$content.find( ":jqmData(role=listview)" ).listview();
		
			options.dataUrl = urlObj.href;
			
			$.mobile.changePage( $page, options );
		}		

		/*function getLibraryHeaderBar(heading)
		{
			var markup = '<h1>' + heading + '</h1>';
			markup += '<a href="#global_options" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a>';
			
			return markup;
		}*/

		function renderGlobalOptions( urlInfoObj, nav_options )
		{
			urlObj = urlInfoObj;
			options = nav_options;				
			
			pageSelector = urlObj.hash.replace( /\?.*$/, "" );
			console.log(pageSelector);
			var qs = $.parseQuerystring(urlObj.hash);

			if(qs['category'] == undefined)
				qs['category'] = currentPlayType;
			if(qs['category'] == "" || qs['category'] == "audio")
				qs['category'] = "music";
			var category = qs['category'];			

			var $page = $( pageSelector );

			$("#playlist_button").attr("href", "#playlist?category=" + category);
			$page.page();
			$.mobile.changePage( $page, options );
		}

	</script>
	
</head> 
<body> 
<div data-role="page" class="type-home swipable">
	<div data-role="content">
		
		<div class="content-primary">
			<nav>
				<ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="b">
					<li data-role="list-divider">XBMC</li>
					<li><a href="#tvshows">TV Shows</a></li>
					<li><a href="#music">Music</a></li>
					<li><a href="#channel_groups">Live TV</a></li>
					<li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-b">Files</li>
					<li><a href="#sourcelist?category=video">Videos</a></li>
					<li><a href="#sourcelist?category=music">Music</a></li>
					<li><a href="#remote">Remote</a></li>
				</ul>
			</nav>
		</div>

	</div>
	
	<div data-role="footer" class="footer-docs" data-theme="c">
			<p>&copy; 2011-2012 James P. Cole</p>
	</div>	
	
</div>
<div id="sourcelist" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="tvshows" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>
<div id="tvseasons" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>
<div id="tvseason" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>
<div id="episode_info" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="music" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=music" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content">
  	<ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="b">
		<li data-role="list-divider">XBMC</li>
		<li><a href="#music_artists">Artist</a></li>
		<li><a href="#music_albums">Album</a></li>
		<!--<li><a href="#music_genres">Genre</a></li>-->
	</ul>
  </div>
</div>

<div id="music_albums" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1>Albums</h1><a href="#global_options?category=music" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="music_artist_albums" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=music" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="music_album" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=music" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="music_artists" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=music" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="channel_groups" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>
<div id="channels" data-role="page" data-add-back-btn="true" class="swipable">
  <div data-role="header"><h1></h1><a href="#global_options?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right">Options</a></div>
  <div data-role="content"></div>
</div>

<div id="remote" data-role="page" data-add-back-btn="true">
	<div data-role="header"><h1>Remote</h1></div>
	<div data-role="content">
		<form>
		<div class="remote-buttons-container">
			
			<input type="range" name="slider" id="volume" class="volume" value="0" min="0" max="100" data-highlight="true" />
		</div>

		<div class="round-button-holder">
			<div class="round-button prev-button"><div class="rw-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>
			<div class="round-button"><div class="play-button play-toggle">&nbsp;</div></div>
			<div class="round-button next-button"><div class="ff-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>			
		</div>

		<div class="round-button-holder">
			<div class="round-button xbmc-input" xbmc-input="Back"><div class="back-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>
			<div class="round-button xbmc-input" xbmc-input="Up"><div class="up-button"><div>&nbsp;</div></div></div>
			<div class="round-button xbmc-input" xbmc-input="Home"><div class="home-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>
		</div>


		<div class="round-button-holder">
			<div class="round-button xbmc-input" xbmc-input="Left"><div class="left-button"><div>&nbsp;</div></div></div>
			<div class="round-button xbmc-input" xbmc-input="Select"><div class="select-button"><div>&nbsp;</div></div></div>
			<div class="round-button xbmc-input" xbmc-input="Right"><div class="right-button"><div>&nbsp;</div></div></div>
		</div>

		<div class="round-button-holder">
			<div class="round-button xbmc-player" xbmc-control="zoom"><div class="">&nbsp;</div></div>
			<div class="round-button xbmc-input" xbmc-input="Down"><div class="">&nbsp;</div></div>
			<div class="round-button" onclick="xbmc.setMute()"><div class="">&nbsp;</div></div>
		</div>

		</form>
	</div>
	<div data-role="footer" data-id="remote_footer" data-position="fixed" class="now-playing" style="display:none;">
		<a href="#now_playing" data-transition="slideup" style="width:100%">
			<img height="40" style="float:left;" class="now_playing_thumbnail" id="remote_playing_thumb" src="" />
			<div class="now_playing_name" style="max-height:20px;overflow:hidden;">
			
			</div>
			<div class="now_playing_time">
			
			</div>
		</a>

		
	</div><!-- /footer -->
	
</div>

<div id="now_playing" data-role="page" data-add-back-btn="true">
	<div data-role="header"><h1>Now Playing</h1></div>
	<div data-role="content">
		<center>
			<div class="now_playing_name" style="font-weight:bold;">
			
			</div>
			<img style="max-height:100px;" class="now_playing_thumbnail" src="" />
			<div class="now_playing_time">
			
			</div>
		</center>
		<div style="width:100%;text-align:center">
			<div class="round-button prev-button"><div class="rw-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>
			<div class="round-button"><div class="play-button play-toggle">&nbsp;</div></div>
			<div class="round-button next-button"><div class="ff-button"><div>&nbsp;</div><div>&nbsp;</div></div></div>			
		</div>
		<input type="range" name="slider" id="volume_np" class="volume" value="0" min="0" max="100" data-highlight="true" />

		<a href="#remote" data-role="button" data-transition="flip">Remote</a>
	</div>

</div>

<div id="playlist" data-role="page" data-add-back-btn="true" class="swipable">
	<div data-role="header"><h1>Playlist</h1><a id="change_playlist_button" href="#playlist?category=video" data-transition="slidedown" data-role="button" data-icon="gear" class="ui-btn-right"><span id="change_playlist_btn_text">Video</span></a></div>
	<div data-role="content">
		
	</div>

</div>

<div id="file_options" data-role="dialog" data-add-back-btn="true">
	<div data-role="header"><h1>Options</h1></div>
	<div data-role="content">
		<a data-role="button" href="javascript:void(0)">Play</a>
		<a data-role="button" href="javascript:void(0)">Queue</a>
		<a data-rel="back" data-role="button" href="#">Cancel</a>
	</div>

</div>

<div id="folder_options" data-role="dialog" data-add-back-btn="true">
	<div data-role="header"><h1>Options</h1></div>
	<div data-role="content">
		<a data-role="button" href="javascript:void(0)">Play</a>
		<a data-role="button" href="javascript:void(0)">Queue</a>
		<a data-rel="back" data-role="button" href="#">Cancel</a>
	</div>

</div>

<div id="playlist_options" data-role="dialog" data-add-back-btn="true">
	<div data-role="header"><h1>Options</h1></div>
	<div data-role="content">
	</div>
</div>

<div id="song_options" data-role="dialog" data-add-back-btn="true">
	<div data-role="header"><h1>Options</h1></div>
	<div data-role="content">
	</div>
</div>

<div id="global_options" data-role="dialog" data-add-back-btn="true">
	<div data-role="header"><h1>Options</h1></div>
	<div data-role="content">
		<a data-role="button" href="#now_playing">Now Playing</a>
		<a data-role="button" href="#remote">Remote</a>
		<a data-role="button" id="playlist_button" href="#playlist">Playlist</a>
		<a data-rel="back" data-role="button" href="#">Cancel</a>
	</div>
</div>


</body>
</html>

